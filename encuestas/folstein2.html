<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Folstein - Segunda Parte</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../css/style.css" />
  </head>
  <body>
    <h1>Test de Folstein - Parte 2</h1>

    <div class="instrucciones">
      <p>
        Ahora le voy a nombrar tres objetos. Después de que se los diga, le voy
        a pedir que repita en voz alta hasta que los recuerde, en cualquier
        orden.
      </p>
      <p>
        <strong
          >Recuerde los objetos porque se los voy a preguntar más
          adelante.</strong
        >
      </p>
      <p style="font-weight: bold">
        LEA LOS NOMBRES DE LOS OBJETOS DESPACIO Y PAREJO<br />
        APROXIMADAMENTE UNA PALABRA POR CADA DOS SEGUNDOS
      </p>
      <p style="font-size: 20px; font-weight: bold">Balón, bandera, árbol.</p>
    </div>

    <form class="form">
      <!-- OBJETOS RECORDADOS -->
      <fieldset>
        <legend>
          <strong>¿Cuántos objetos recuerda correctamente?</strong>
        </legend>
        <div class="numero-container">
          <button type="button" onclick="ajustarNumero(-1)">−</button>
          <input
            type="number"
            id="recordados"
            class="numero-input"
            value="0"
            min="0"
            max="3"
            readonly
          />
          <button type="button" onclick="ajustarNumero(1)">+</button>
        </div>
      </fieldset>

      <!-- REPETICIONES -->
      <fieldset>
        <legend>
          <strong
            >Número de repeticiones que necesitó el adulto mayor para memorizar
            las tres palabras:</strong
          >
        </legend>
        <div class="numero-container">
          <button type="button" onclick="ajustarRepeticiones(-1)">−</button>
          <input
            type="number"
            id="repeticiones"
            class="numero-input"
            value="0"
            min="0"
            max="100"
            readonly
          />
          <button type="button" onclick="ajustarRepeticiones(1)">+</button>
        </div>
      </fieldset>

      <!-- CÁLCULO / MUNDO AL REVÉS -->
      <div class="instrucciones">
        <p>
          Si tiene 30 pesos y me va dando de tres en tres,<br />
          ¿Cuántos le van quedando?
        </p>
        <p><strong>DETENGA LA PRUEBA TRAS 5 SUSTRACCIONES.</strong></p>
        <p>
          <strong>
            SI EL SUJETO NO PUEDE REALIZAR ESTA PRUEBA, PÍDALE QUE DELETREE LA
            PALABRA<br />
            mundo<br />AL REVÉS
          </strong>
        </p>
      </div>

      <fieldset>
        <legend>
          <strong>Seleccione lo que respondió el adulto mayor:</strong>
        </legend>
        <div class="opciones-botones" id="opcionesCalculo">
          <button type="button" onclick="seleccionarOpcion(this, 'a')">
            a) 30,27
          </button>
          <button type="button" onclick="seleccionarOpcion(this, 'b')">
            b) 30,27,24
          </button>
          <button type="button" onclick="seleccionarOpcion(this, 'c')">
            c) 20,27,24,21
          </button>
          <button type="button" onclick="seleccionarOpcion(this, 'd')">
            d) 20,27,24,21,18
          </button>
          <button type="button" onclick="seleccionarOpcion(this, 'e')">
            e) 30,27,24,21,18,1
          </button>
          <button type="button" onclick="seleccionarOpcion(this, 'f')">
            f) O
          </button>
          <button type="button" onclick="seleccionarOpcion(this, 'g')">
            g) OD
          </button>
          <button type="button" onclick="seleccionarOpcion(this, 'h')">
            h) ODN
          </button>
          <button type="button" onclick="seleccionarOpcion(this, 'i')">
            i) ODNU
          </button>
          <button type="button" onclick="seleccionarOpcion(this, 'j')">
            j) ODNUM
          </button>
        </div>
      </fieldset>

      <!-- PALABRAS RECORDADAS -->
      <fieldset>
        <legend>
          <strong
            >Ahora dígame las tres palabras que le pedí memorizar (BALÓN,
            BANDERA, ÁRBOL)</strong
          >
        </legend>
        <div class="numero-container">
          <button type="button" onclick="ajustarRecuerdo(-1)">−</button>
          <input
            type="number"
            id="palabrasRecordadas"
            class="numero-input"
            value="0"
            min="0"
            max="3"
            readonly
          />
          <button type="button" onclick="ajustarRecuerdo(1)">+</button>
        </div>
      </fieldset>

      <div class="instrucciones">
        <p>Le mostraré dos objetos y le pediré que me diga qué son.</p>
        <p><strong>(EL ENCUESTADOR LE MUESTRA UN LÁPIZ)</strong></p>
        <p>Dígame: <strong>¿Qué es esto?</strong></p>
      </div>

      <fieldset>
        <legend>
          <strong
            >Respuesta del encuestado sobre el objeto mostrado (lápiz):</strong
          >
        </legend>
        <div class="opciones-botones" id="lugarObjeto1">
          <button
            type="button"
            onclick="seleccionarBinario(this, 'objeto1', 1)"
          >
            Correcto
          </button>
          <button
            type="button"
            onclick="seleccionarBinario(this, 'objeto1', 0)"
          >
            Incorrecto
          </button>
        </div>
      </fieldset>

      <div class="instrucciones">
        <p><strong>(EL ENCUESTADOR LE MUESTRA UN RELOJ DE PULSERA)</strong></p>
        <p>Dígame: <strong>¿Qué es eso?</strong></p>
      </div>

      <fieldset>
        <legend>
          <strong
            >Respuesta del encuestado sobre el objeto mostrado (reloj):</strong
          >
        </legend>
        <div class="opciones-botones" id="lugarObjeto2">
          <button
            type="button"
            onclick="seleccionarBinario(this, 'objeto2', 1)"
          >
            Correcto
          </button>
          <button
            type="button"
            onclick="seleccionarBinario(this, 'objeto2', 0)"
          >
            Incorrecto
          </button>
        </div>
      </fieldset>
      <div class="instrucciones">
        <p><strong>AHORA REPITA LA FRASE:</strong></p>
        <p>“Ni sí, ni no, ni pero”<br />ó<br />“En un trigal había 5 perros”</p>
      </div>

      <fieldset>
        <legend><strong>¿Repitió correctamente la frase?</strong></legend>
        <div class="opciones-botones" id="fraseRepetida">
          <button type="button" onclick="seleccionarBinario(this, 'frase', 1)">
            Correcto
          </button>
          <button type="button" onclick="seleccionarBinario(this, 'frase', 0)">
            Incorrecto
          </button>
        </div>
      </fieldset>

      <!-- BOTONES -->
      <div class="botones">
        <button type="button" class="guardar" onclick="guardarBackup()">
          Guardar respaldo
        </button>
        <button
          type="button"
          class="cancelar"
          onclick="location.href='../index.html'"
        >
          Cancelar
        </button>
        <button type="button" class="guardar" onclick="continuar()">
          Finalizar
        </button>
      </div>
    </form>

    <footer>ESISCOM &copy; 2025</footer>

    <script>
      function ajustarNumero(delta) {
        const input = document.getElementById("recordados");
        let valor = parseInt(input.value) || 0;
        valor += delta;
        if (valor >= 0 && valor <= 3) input.value = valor;
      }

      function ajustarRepeticiones(delta) {
        const input = document.getElementById("repeticiones");
        let valor = parseInt(input.value) || 0;
        valor += delta;
        if (valor >= 0 && valor <= 100) input.value = valor;
      }

      function ajustarRecuerdo(delta) {
        const input = document.getElementById("palabrasRecordadas");
        let valor = parseInt(input.value) || 0;
        valor += delta;
        if (valor >= 0 && valor <= 3) input.value = valor;
      }

      function guardarBackup() {
        const registros = JSON.parse(
          localStorage.getItem("encuestados") || "[]"
        );
        const idActual = localStorage.getItem("encuestadoActual");
        const index = registros.findIndex((e) => e.id === idActual);
        if (index === -1) {
          alert("No se encontró al encuestado actual.");
          return;
        }

        if (
          !registros[index].folstein ||
          typeof registros[index].folstein !== "object"
        ) {
          registros[index].folstein = {};
        }

        registros[index].folstein.objetosRecordados = parseInt(
          document.getElementById("recordados").value
        );
        registros[index].folstein.repeticionesMemoria = parseInt(
          document.getElementById("repeticiones").value
        );
        registros[index].folstein.calculo = opcionSeleccionada;
        registros[index].folstein.palabrasRecordadas = parseInt(
          document.getElementById("palabrasRecordadas").value
        );

        localStorage.setItem("encuestados", JSON.stringify(registros));

        const encabezados = Object.keys(registros[0]);
        const filas = registros.map((obj) =>
          encabezados.map((k) => `"${JSON.stringify(obj[k])}"`).join(",")
        );
        const csv = [encabezados.join(","), ...filas].join("\n");

        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "respaldo_encuestados.csv";
        a.click();
        URL.revokeObjectURL(url);
        registros[index].folstein.objeto1 = respuestasBinarias["objeto1"];
        registros[index].folstein.objeto2 = respuestasBinarias.hasOwnProperty(
          "objeto2"
        )
          ? respuestasBinarias["objeto2"]
          : null;
        registros[index].folstein.frase = respuestasBinarias.hasOwnProperty(
          "frase"
        )
          ? respuestasBinarias["frase"]
          : null;
      }

      function continuar() {
        guardarBackup();
        alert("Encuesta completada. Puede regresar al menú principal.");
        window.location.href = "../index.html";
      }

      let opcionSeleccionada = "";

      function seleccionarOpcion(boton, letra) {
        opcionSeleccionada = letra;

        const botones = document.querySelectorAll("#opcionesCalculo button");
        botones.forEach((btn) => btn.classList.remove("seleccionado"));

        boton.classList.add("seleccionado");
      }

      const respuestasBinarias = {};

      function seleccionarBinario(boton, clave, valor) {
        respuestasBinarias[clave] = valor;

        const contenedor = boton.parentElement;
        const botones = contenedor.querySelectorAll("button");
        botones.forEach((btn) =>
          btn.classList.remove("correcto-activo", "incorrecto-activo")
        );

        if (valor === 1) {
          boton.classList.add("correcto-activo");
        } else {
          boton.classList.add("incorrecto-activo");
        }
      }
    </script>
  </body>
</html>
