<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Encuesta Folstein (MMSE)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../css/style.css" />
    <style>
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(40, 0, 60, 0.95);
        color: white;
        z-index: 9999;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
        overflow-y: auto;
      }

      .modal-contenido {
        max-width: 90%;
        max-height: 90vh;
        text-align: left;
        background-color: transparent;
        padding: 20px;
        border-radius: 10px;
        font-size: 16px;
        line-height: 1.4;
        overflow-y: auto;
      }

      .modal-contenido button {
        display: block;
        margin: 20px auto 0;
        font-size: 18px;
        padding: 10px 25px;
      }

      .respuesta-btn {
        font-size: 20px;
        padding: 16px 28px;
        margin: 10px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        min-width: 140px;
      }

      .correcto-activo {
        background-color: #4caf50 !important;
        color: white;
      }

      .incorrecto-activo {
        background-color: #f44336 !important;
        color: white;
      }
    </style>
  </head>
  <body>
    <h1>Test de Folstein (Mini-Mental)</h1>

    <!-- MODAL INICIAL -->
    <div id="modalInstrucciones" class="modal-overlay">
      <div class="modal-contenido">
        <p>
          A continuación, se le pedirá responder unas preguntas relacionadas con
          sus conocimientos generales.<br /><br />
          Le pido escuchar atentamente las instrucciones.<br /><br />
          Antes de iniciar ¿Tiene usted alguna duda o inquietud que le gustaría
          comentar o resolver?
        </p>
        <p style="text-align: center; font-weight: bold; margin-top: 20px">
          SI EL ADULTO MAYOR NO TIENE NINGUNA DUDA<br />
          OPRIMA EL BOTÓN OK.
        </p>
        <button onclick="cerrarModal()" class="guardar">OK</button>
      </div>
    </div>

    <!-- FORMULARIO -->
    <form id="formFolstein" class="form">
      <fieldset>
        <legend><strong>1. ¿En qué año estamos?</strong></legend>
        <button
          type="button"
          class="respuesta-btn"
          onclick="marcarRespuesta(this, 'p1', 1)"
        >
          Correcto
        </button>
        <button
          type="button"
          class="respuesta-btn"
          onclick="marcarRespuesta(this, 'p1', 0)"
        >
          Incorrecto
        </button>
      </fieldset>

      <fieldset>
        <legend><strong>2. ¿En qué estación estamos?</strong></legend>
        <button
          type="button"
          class="respuesta-btn"
          onclick="marcarRespuesta(this, 'p2', 1)"
        >
          Correcto
        </button>
        <button
          type="button"
          class="respuesta-btn"
          onclick="marcarRespuesta(this, 'p2', 0)"
        >
          Incorrecto
        </button>
      </fieldset>

      <fieldset>
        <legend><strong>3. ¿En qué día del mes estamos?</strong></legend>
        <button
          type="button"
          class="respuesta-btn"
          onclick="marcarRespuesta(this, 'p3', 1)"
        >
          Correcto
        </button>
        <button
          type="button"
          class="respuesta-btn"
          onclick="marcarRespuesta(this, 'p3', 0)"
        >
          Incorrecto
        </button>
      </fieldset>

      <fieldset>
        <legend><strong>4. ¿En qué mes estamos?</strong></legend>
        <button
          type="button"
          class="respuesta-btn"
          onclick="marcarRespuesta(this, 'p4', 1)"
        >
          Correcto
        </button>
        <button
          type="button"
          class="respuesta-btn"
          onclick="marcarRespuesta(this, 'p4', 0)"
        >
          Incorrecto
        </button>
      </fieldset>

      <fieldset>
        <legend><strong>5. ¿En qué día de la semana estamos?</strong></legend>
        <button
          type="button"
          class="respuesta-btn"
          onclick="marcarRespuesta(this, 'p5', 1)"
        >
          Correcto
        </button>
        <button
          type="button"
          class="respuesta-btn"
          onclick="marcarRespuesta(this, 'p5', 0)"
        >
          Incorrecto
        </button>
      </fieldset>

      <fieldset>
        <legend><strong>6. ¿En qué lugar estamos?</strong></legend>
        <button
          type="button"
          class="respuesta-btn"
          onclick="marcarRespuesta(this, 'p6', 1)"
        >
          Correcto
        </button>
        <button
          type="button"
          class="respuesta-btn"
          onclick="marcarRespuesta(this, 'p6', 0)"
        >
          Incorrecto
        </button>
      </fieldset>

      <fieldset>
        <legend><strong>7. ¿En qué piso o sala estamos?</strong></legend>
        <button
          type="button"
          class="respuesta-btn"
          onclick="marcarRespuesta(this, 'p7', 1)"
        >
          Correcto
        </button>
        <button
          type="button"
          class="respuesta-btn"
          onclick="marcarRespuesta(this, 'p7', 0)"
        >
          Incorrecto
        </button>
      </fieldset>

      <fieldset>
        <legend><strong>8. ¿En qué ciudad o pueblo estamos?</strong></legend>
        <button
          type="button"
          class="respuesta-btn"
          onclick="marcarRespuesta(this, 'p8', 1)"
        >
          Correcto
        </button>
        <button
          type="button"
          class="respuesta-btn"
          onclick="marcarRespuesta(this, 'p8', 0)"
        >
          Incorrecto
        </button>
      </fieldset>

      <fieldset>
        <legend><strong>9. ¿En qué municipio estamos?</strong></legend>
        <button
          type="button"
          class="respuesta-btn"
          onclick="marcarRespuesta(this, 'p9', 1)"
        >
          Correcto
        </button>
        <button
          type="button"
          class="respuesta-btn"
          onclick="marcarRespuesta(this, 'p9', 0)"
        >
          Incorrecto
        </button>
      </fieldset>

      <fieldset>
        <legend><strong>10. ¿En qué país estamos?</strong></legend>
        <button
          type="button"
          class="respuesta-btn"
          onclick="marcarRespuesta(this, 'p10', 1)"
        >
          Correcto
        </button>
        <button
          type="button"
          class="respuesta-btn"
          onclick="marcarRespuesta(this, 'p10', 0)"
        >
          Incorrecto
        </button>
      </fieldset>

      <div class="botones">
        <button type="button" class="guardar" onclick="guardarBackup()">
          Guardar respaldo
        </button>
        <button
          type="button"
          class="cancelar"
          onclick="location.href='../index.html'"
        >
          Cancelar
        </button>
      </div>
    </form>

    <footer>ESISCOM &copy; 2025</footer>

    <script>
      const respuestas = {};

      function marcarRespuesta(boton, pregunta, valor) {
        respuestas[pregunta] = valor;
        const botones = boton.parentElement.querySelectorAll(".respuesta-btn");
        botones.forEach((btn) =>
          btn.classList.remove("correcto-activo", "incorrecto-activo")
        );
        if (valor === 1) {
          boton.classList.add("correcto-activo");
        } else {
          boton.classList.add("incorrecto-activo");
        }
      }

      function guardarBackup() {
        const registros = JSON.parse(
          localStorage.getItem("encuestados") || "[]"
        );
        const idActual = localStorage.getItem("encuestadoActual");
        const index = registros.findIndex((e) => e.id === idActual);

        if (index === -1) {
          alert("No se encontró al encuestado actual.");
          return;
        }

        registros[index].folstein = respuestas;
        localStorage.setItem("encuestados", JSON.stringify(registros));

        const encabezados = Object.keys(registros[0]);
        const filas = registros.map((obj) =>
          encabezados.map((k) => `"${JSON.stringify(obj[k])}"`).join(",")
        );
        const csv = [encabezados.join(","), ...filas].join("\n");

        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "respaldo_encuestados.csv";
        a.click();
        URL.revokeObjectURL(url);
      }

      function cerrarModal() {
        document.getElementById("modalInstrucciones").style.display = "none";
      }
    </script>
  </body>
</html>
